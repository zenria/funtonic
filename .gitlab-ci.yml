image: 'registry.scoopit.io/scoopit-runner'

stages:
  - build
  - deploy

build:
  stage: build
  script:
    - rustup toolchain install beta
    - rustup component add rustfmt --toolchain beta-x86_64-unknown-linux-gnu
    - cargo build --all --all-targets --color=always
    - RUST_BACKTRACE=1 cargo test

release:
  stage: build
  only:
    - tags
  script:
    - rustup toolchain install beta
    - rustup component add rustfmt --toolchain beta-x86_64-unknown-linux-gnu
    - cargo build --release --all --all-targets --color=always
    - binrep push funtonic $CI_COMMIT_TAG target/release/executor target/release/taskserver target/release/commander
